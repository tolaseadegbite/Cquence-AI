<% frame_id = dom_id(song, "like_button") %>

<%= turbo_frame_tag frame_id do %>
  <div class="flex items-center">
    <% if user_signed_in? %>
      <% like = song.current_user_like %>

      <% if like.nil? %>
        <%# --- "LIKE" FORM --- %>
        <%= form_with model: [song, Like.new], html: { "data-turbo-frame": frame_id } do |f| %>
          <%= f.button class: "btn btn--icon btn--plain", "aria-label": "Like song" do %>
            <%# The inline SVG for the UNLIKED state %>
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" class="text-subtle" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
            </svg>
          <% end %>
        <% end %>
      <% else %>
        <%# --- "UNLIKE" FORM --- %>
        <%= form_with url: song_like_path(song, like), method: :delete, html: { "data-turbo-frame": frame_id } do |f| %>
          <%= f.button class: "btn btn--icon btn--plain", "aria-label": "Unlike song" do %>
            <%# The inline SVG for the LIKED state %>
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="text-rose-500" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
            </svg>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

    <span class="text-sm text-subtle"><%= pluralize(song.likes_count, "like") %></span>
  </div>
<% end %>