<div class="main-wrapper py-5 px-6">
  <h1 class="text-3xl font-semibold mbe-6">Discover Music</h1>

  <section class="mbe-10">
    <h2 class="text-2xl font-semibold mbe-4">Recently Added</h2>

    <div class="grid grid-cols-2 grid-cols-3@sm grid-cols-3@md grid-cols-6@lg gap-x-4 gap-y-8">
      <% @songs.each do |song| %>
        <div>
          <%# This button now directly calls the global `player` controller via data-action. %>
          <%# The data-player-* params pass all the necessary info for playback. %>
          <button type="button" class="card-image-wrapper mbe-2"
                  data-action="player#show"
                  data-player-url-param="<%= presigned_s3_url(song.s3_key) %>"
                  data-player-title-param="<%= song.title %>"
                  data-player-artist-param="<%= song.user.name %>"
                  data-player-artwork-param="<%= presigned_s3_url(song.thumbnail_s3_key) %>">
            <div class="relative">
              <% if thumbnail_url = presigned_s3_url(song.thumbnail_s3_key) %>
                <%= image_tag thumbnail_url, alt: song.title, class: "block album-art object-cover rounded-md" %>
              <% else %>
                <div class="bg-surface block album-art rounded-md flex items-center justify-center">
                  <span class="icon icon--music text-subtle" style="--icon-size: 3rem"></span>
                </div>
              <% end %>
              <div class="card-overlay flex items-center justify-center rounded-md">
                <span class="icon icon--play text-gray-50" style="--icon-size: 3rem" aria-hidden="true"></span>
              </div>
            </div>
          </button>
          
          <p class="text-base font-semibold overflow-ellipsis whitespace-nowrap"><%= song.title %></p>
          <p class="text-sm text-subtle mbe-1"><%= song.user.name %></p>
          <div class="flex items-center justify-between gap-1">
            <p class="text-sm text-subtle"><%= pluralize(song.listen_count, "listen") %></p>
            <div class="flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="<%= song.likes_count > 0 ? 'white' : 'none' %>" class="<%= song.likes_count > 0 ? '' : 'text-subtle' %>" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
              <span class="text-sm text-subtle"><%= pluralize(song.likes_count, "like") %></span>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </section>
</div>